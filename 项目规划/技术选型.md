# 技术选型
## 后端
### 主语言：Go 
### 数据库 ORM
- PostgreSQL
- GORM(pgx)
### web框架
- Gin 
### 身份认证
- JWT(RS256)
- Refresh Tokens + Revocation机制
### 消息队列
- 消息代理：Redis
- 任务库：Asynq
- 执行：Go Worker(Asynq Server)
- 通知：WebSockets
### 配置管理
- Viper
### PDF处理
- 导出：go-rod 
- 后处理：pdfcpu
## 前端
### 主语言：React 
- 框架：Next.js

## 文件存储
### 对象存储
- 阿里云OSS
### 病毒/恶意文件扫描
- 边车 ClamAV 扫描

## 结构化日志
### 后端内部
- slog
- 关键:对每个请求生成对应的id,在每一步都传递下去
### 中控日志
- Loki + Promtail + Grafana
- 指标收集 Prometheus
## 部署
### 开发
- 全容器化
### CI/CD
- GitHub Actions
### 生产
- 容器+托管

### 反向代理
- Nginx


------------
# 技术选型版本管理
---

### 1. 后端 (Go 生态)

在你的 `backend/go.mod` 文件中，你将定义这些依赖：

* **Go (语言):** `go 1.25.3`
    * **理由：** 这是当前的最新稳定版。`slog` (结构化日志) 库在 Go 1.21+ 中已成为标准库，使用 `1.25.x` 可以获得最佳的性能和安全修复。
* **Gin (Web框架):** `v1.10.x`
    * **理由：** 生产环境的黄金标准，`v1.10` 是一个稳定且功能丰富的版本。
* **GORM (ORM):** `v1.25.x`
    * **理由：** `v1.25` 系列是 GORM 的当前主流版本，提供了稳定的 API 和强大的功能。
* **GORM Driver (pgx):** `gorm.io/driver/postgres v1.5.x`
    * **理由：** 与 `GORM v1.25` 兼容的最新版 `pgx` 驱动，性能优于 `pq`。
* **Asynq (任务队列):** `v0.25.1`
    * **理由：** 这是一个非常稳定且被广泛使用的版本，是 `hibiken/asynq` 的主流选择。
* **Viper (配置管理):** `v1.19.x`
    * **理由：** 非常成熟的配置库，API 极其稳定。
* **go-rod (PDF 导出):** `v0.116.x`
    * **理由：** `go-rod` 的版本需要与你 `Dockerfile.worker` 中安装的 `Chromium` 浏览器版本相匹配。`v0.116.x` 是一个较新且稳定的版本。
* **pdfcpu (PDF 处理):** `v0.8.x`
    * **理由：** 功能全面且稳定的 PDF 处理库。
* **golang-jwt/jwt (JWT):** `v5.2.x`
    * **理由：** 这是社区维护的 `jwt-go` 活跃分支，`v5` 是当前的稳定主版本。
* **AWS SDK for Go (OSS):** `v1.30.x` (`github.com/aws/aws-sdk-go-v2`)
    * **理由：** 使用 `v2` 版本的 AWS SDK，它与阿里云 OSS S3 兼容模式完全兼容，并且设计更现代。

### 2. 前端 (Node.js 生态)

在你的 `frontend/package.json` 文件中，你将定义这些依赖：

* **Node.js (运行环境):** `v20.x` (LTS)
    * **理由：** **必须**使用 LTS (长期支持) 版本。`v20` 是当前的 LTS，能确保在生产环境中的稳定性和安全性。
* **Next.js (React 框架):** `v14.2.x`
    * **理由：** `v14` 是 Next.js 的最新主版本，包含了 App Router 等所有现代特性。
* **React (UI 库):** `v18.3.x`
    * **理由：** `v18` 是 React 的当前主版本，由 Next.js 14 自动捆绑和管理。

### 3. 基础设施 & 服务 (Docker 镜像)

在你的 `docker-compose.yml` 文件中，你将使用这些镜像标签：

* **PostgreSQL (数据库):** `postgres:16.3-alpine`
    * **理由：** `16` 是最新的主版本。`alpine` 镜像是轻量级的，非常适合在容器中运行。
* **Redis (消息代理):** `redis:7.2-alpine`
    * **理由：** `8.2` 是最新的稳定系列，`alpine` 版本体积小。
* **Nginx (反向代理):** `nginx:1.27-alpine`
    * **理由：** `1.27` 是 Nginx 的 `stable` (稳定) 分支。
* **ClamAV (病毒扫描):** `clamav/clamav:1.3.x`
    * **理由：** 官方 Docker 镜像的最新稳定版本。
* **Loki (日志后端):** `grafana/loki:3.0.0`
    * **理由：** `v3.0` 是 Loki 的一个重要里程碑，提供了更强的功能和稳定性。
* **Promtail (日志代理):** `grafana/promtail:3.0.0`
    * **理由：** **必须**与 Loki 的主版本保持一致。
* **Prometheus (指标):** `prom/prometheus:v2.53.x`
    * **理由：** `v2` 系列的最新稳定版本。
* **Grafana (仪表盘):** `grafana/grafana:11.1.x`
    * **理由：** `v11` 是 Grafana 的最新主版本，提供了最佳的可视化体验。

### 4. 工具链

* **Docker Engine:** `26.x` 或更高
* **Docker Compose:** `v2.27.x` 或更高 (即 `docker compose` CLI 插件)
* **GitHub Actions Runner:** `ubuntu-latest`
    * **理由：** 在 CI/CD 中，使用 `ubuntu-latest` (目前是 22.04) 可以确保你的构建环境始终是最新的，并预装了 `docker` 和 `go`。

---
